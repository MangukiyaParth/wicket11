<IfModule mod_php5.c>
    php_flag session.auto_start 1
</IfModule>

<Files .env>
    Order allow,deny
    Deny from all
</Files>

RewriteEngine On

# 1. Serve static files directly (JS, CSS, images, etc.)
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 2. Strip cache-busting hashes from CSS/JS
RewriteRule ^(.*)\.[\d]{10}\.(css|js)$ $1.$2 [L]

# 3. Redirect HTTP to HTTPS (skip for localhost or IPs)
RewriteCond %{HTTPS} off
RewriteCond %{HTTP_HOST} !^localhost [NC]
RewriteCond %{HTTP_HOST} !^192\. [NC]
RewriteRule ^ https://%{HTTP_HOST}%{REQUEST_URI} [L,R=301]

# 4. Route PHP pages
RewriteRule ^login/?$ login.php [L]
RewriteRule ^logout/?$ logout.php [L]
RewriteRule ^page/([^/]+)/?$ manage.php?id=$1 [NC,L]
